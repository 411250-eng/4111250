<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½œæ¥­ç¹³äº¤ç®¡ç†ç³»çµ±</title>
    <style>
        :root {
            --primary: #4a90e2;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --success: #2ecc71;
            --dark: #2c3e50;
            --light: #f5f6fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 { text-align: center; color: var(--primary); margin-bottom: 30px; }

        /* è¼¸å…¥å€åŸŸæ¨£å¼ */
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: #eef2f7;
            border-radius: 8px;
        }

        .form-control {
            margin-bottom: 10px;
        }
        
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
        
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒæ’å¤§å¯¬åº¦ */
        }

        button#addBtn {
            grid-column: span 2;
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button#addBtn:hover { background-color: #357abd; }

        /* åˆ—è¡¨æ¨£å¼ */
        .assignment-list {
            margin-top: 20px;
        }

        .card {
            background: white;
            border: 1px solid #eee;
            border-left: 5px solid var(--primary);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }

        .card:hover { transform: translateY(-2px); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        .card.urgent { border-left-color: var(--danger); background-color: #fff5f5; }
        .card.warning { border-left-color: var(--warning); }
        .card.finished { border-left-color: var(--success); opacity: 0.7; }

        .info h3 { margin: 0 0 5px 0; font-size: 1.1em; }
        .info p { margin: 0; color: #666; font-size: 0.9em; }
        .timer { font-weight: bold; color: var(--primary); }
        
        .actions button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 600px) {
            .input-group { grid-template-columns: 1fr; }
            button#addBtn { grid-column: span 1; }
            .card { flex-direction: column; align-items: flex-start; }
            .actions { margin-top: 10px; width: 100%; text-align: right; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“ ä½œæ¥­ç¹³äº¤è¿½è¹¤å™¨</h1>
    
    <div class="input-group">
        <div class="form-control">
            <label>ä½œæ¥­åç¨±</label>
            <input type="text" id="taskName" placeholder="ä¾‹å¦‚ï¼šæœŸæœ«ç¨‹å¼ä½œæ¥­">
        </div>
        <div class="form-control">
            <label>ç¹³äº¤æœŸé™</label>
            <input type="datetime-local" id="taskDeadline">
        </div>
        <div class="form-control" style="grid-column: span 2;">
            <label>ä¸Šå‚³ä½œæ¥­æª”æ¡ˆ (æ¨¡æ“¬)</label>
            <input type="file" id="taskFile">
        </div>
        <button id="addBtn" onclick="addAssignment()">æäº¤ä¸¦è¨­å®šæé†’</button>
    </div>

    <div id="list" class="assignment-list">
        </div>
</div>

<script>
    // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´é€šçŸ¥
    if ("Notification" in window) {
        Notification.requestPermission();
    }

    let assignments = JSON.parse(localStorage.getItem('assignments')) || [];

    function addAssignment() {
        const name = document.getElementById('taskName').value;
        const deadline = document.getElementById('taskDeadline').value;
        const fileInput = document.getElementById('taskFile');
        
        if (!name || !deadline) {
            alert("è«‹å¡«å¯«ä½œæ¥­åç¨±å’ŒæœŸé™ï¼");
            return;
        }

        const fileName = fileInput.files.length > 0 ? fileInput.files[0].name : "æœªé¸æ“‡æª”æ¡ˆ";

        const newAssignment = {
            id: Date.now(),
            name: name,
            deadline: new Date(deadline).getTime(),
            fileName: fileName,
            notified: false // æ¨™è¨˜æ˜¯å¦å·²ç¶“é€šçŸ¥é
        };

        assignments.push(newAssignment);
        saveAndRender();
        
        // æ¸…ç©ºè¼¸å…¥
        document.getElementById('taskName').value = '';
        document.getElementById('taskFile').value = '';
    }

    function deleteAssignment(id) {
        assignments = assignments.filter(task => task.id !== id);
        saveAndRender();
    }

    function saveAndRender() {
        localStorage.setItem('assignments', JSON.stringify(assignments));
        renderList();
    }

    function renderList() {
        const listEl = document.getElementById('list');
        listEl.innerHTML = '';

        // æ ¹æ“šæ™‚é–“æ’åº
        assignments.sort((a, b) => a.deadline - b.deadline);

        assignments.forEach(task => {
            const now = new Date().getTime();
            const timeLeft = task.deadline - now;
            
            let statusClass = '';
            let timerText = '';

            if (timeLeft < 0) {
                statusClass = 'urgent'; // éæœŸ
                timerText = 'âš ï¸ å·²éæœŸ';
            } else if (timeLeft < 3600000) { // å°æ–¼ 1 å°æ™‚
                statusClass = 'urgent';
                timerText = `å‰©é¤˜: ${formatTime(timeLeft)}`;
            } else if (timeLeft < 86400000) { // å°æ–¼ 24 å°æ™‚
                statusClass = 'warning';
                timerText = `å‰©é¤˜: ${formatTime(timeLeft)}`;
            } else {
                statusClass = '';
                timerText = `å‰©é¤˜: ${formatTime(timeLeft)}`;
            }

            const div = document.createElement('div');
            div.className = `card ${statusClass}`;
            div.innerHTML = `
                <div class="info">
                    <h3>${task.name}</h3>
                    <p>ğŸ“„ æª”æ¡ˆ: ${task.fileName}</p>
                    <p>â° æœŸé™: ${new Date(task.deadline).toLocaleString()}</p>
                </div>
                <div class="actions">
                    <span class="timer">${timerText}</span>
                    <button onclick="deleteAssignment(${task.id})">åˆªé™¤</button>
                </div>
            `;
            listEl.appendChild(div);
        });
    }

    // æ ¼å¼åŒ–æ™‚é–“é¡¯ç¤º (æ¯«ç§’ -> å¤©/æ™‚/åˆ†/ç§’)
    function formatTime(ms) {
        const seconds = Math.floor((ms / 1000) % 60);
        const minutes = Math.floor((ms / (1000 * 60)) % 60);
        const hours = Math.floor((ms / (1000 * 60 * 60)) % 24);
        const days = Math.floor(ms / (1000 * 60 * 60 * 24));

        if (days > 0) return `${days}å¤© ${hours}æ™‚`;
        if (hours > 0) return `${hours}æ™‚ ${minutes}åˆ†`;
        return `${minutes}åˆ† ${seconds}ç§’`;
    }

    // æª¢æŸ¥æ™‚é–“ä¸¦ç™¼é€é€šçŸ¥ (æ¯ç§’åŸ·è¡Œ)
    setInterval(() => {
        const now = Date.now();
        let needsRender = false;

        assignments.forEach(task => {
            const timeLeft = task.deadline - now;

            // å¦‚æœå‰©é¤˜æ™‚é–“å°æ–¼ 10 åˆ†é˜ (600000ms) ä¸”å°šæœªé€šçŸ¥
            // ä¸”æ™‚é–“é‚„æ²’éæœŸ (timeLeft > 0)
            if (timeLeft > 0 && timeLeft < 600000 && !task.notified) {
                sendNotification(`âš ï¸ ä½œæ¥­å¿«æˆªæ­¢äº†ï¼`, `ä½œæ¥­ã€Œ${task.name}ã€åªå‰©ä¸‹ä¸åˆ° 10 åˆ†é˜ï¼Œè«‹ç¢ºèªæ˜¯å¦å·²ç¹³äº¤ï¼`);
                task.notified = true;
                needsRender = true; // å› ç‚ºç‹€æ…‹æ”¹è®Šï¼Œéœ€è¦é‡æ–°å„²å­˜
            }
        });

        // æ¯ç§’æ›´æ–°ç•«é¢ä¸Šçš„å€’æ•¸è¨ˆæ™‚
        renderList();
        
        if (needsRender) {
            localStorage.setItem('assignments', JSON.stringify(assignments));
        }
    }, 1000);

    function sendNotification(title, body) {
        if (Notification.permission === "granted") {
            new Notification(title, {
                body: body,
                icon: "https://cdn-icons-png.flaticon.com/512/2921/2921222.png" // ä¸€å€‹ç°¡å–®çš„åœ–æ¨™
            });
        } else {
            // å¦‚æœä½¿ç”¨è€…æ²’é–‹é€šçŸ¥ï¼Œå°±ç”¨ alert æ›¿ä»£
            alert(`${title}\n${body}`);
        }
    }

    // åˆå§‹åŒ–æ¸²æŸ“
    renderList();
</script>

</body>
</html>